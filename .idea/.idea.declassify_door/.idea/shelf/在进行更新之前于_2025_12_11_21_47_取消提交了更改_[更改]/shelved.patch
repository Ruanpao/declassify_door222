Index: Source/declassify_door/Private/Actor/RotateDoor.cpp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Fill out your copyright notice in the Description page of Project Settings.\r\n\r\n\r\n#include \"Actor/RotateDoor.h\"\r\n\r\n#include \"Actor/HidePass.h\"\r\n#include \"Kismet/GameplayStatics.h\"\r\n#include \"Engine/Engine.h\"\r\n#include \"GameFramework/CharacterMovementComponent.h\"\r\n#include \"GameFramework/Character.h\"\r\n\r\nARotateDoor::ARotateDoor()\r\n{\r\n\tPrimaryActorTick.bCanEverTick = false;\r\n\r\n\tUSceneComponent* Root = CreateDefaultSubobject<USceneComponent>(TEXT(\"Root\"));\r\n\tRootComponent = Root;\r\n\r\n\tDoorMesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT(\"DoorMesh\"));\r\n\tDoorMesh->SetupAttachment(RootComponent);\r\n\r\n}\r\n\r\nvoid ARotateDoor::BeginPlay()\r\n{\r\n\tSuper::BeginPlay();\r\n\t\r\n}\r\n\r\nvoid ARotateDoor::Tick(float DeltaTime)\r\n{\r\n\tSuper::Tick(DeltaTime);\r\n\r\n}\r\n\r\nvoid ARotateDoor::RotateDoor()\r\n{\r\n\tif(bIsRotated)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tbIsRotated = true;\r\n\t\r\n\tFRotator CurrentRotation = DoorMesh->GetRelativeRotation();\r\n\tCurrentRotation.Roll += 180.0f;\r\n\tDoorMesh->SetRelativeRotation(CurrentRotation);\r\n\r\n\tFVector DoorUp = DoorMesh->GetUpVector();\r\n\tFVector DoorDown = -DoorUp;\r\n\t\r\n\tFVector CurrentLocation = DoorMesh->GetRelativeLocation();\r\n\tCurrentLocation += DoorDown * 340.0f; \r\n\t\r\n\tDoorMesh->SetRelativeLocation(CurrentLocation);\r\n\t\r\n\tbIsRotated = false;\r\n\r\n\tbIsUpsideDown = !bIsUpsideDown;\r\n\t\r\n}\r\n\r\nvoid ARotateDoor::OnInteract_Implementation(AActor* Interactor)\r\n{\r\n\tif(!Interactor)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(ACharacter* Character = Cast<ACharacter>(Interactor))\r\n\t{\r\n\t\t\t\r\n\t\tFVector CharacterLocation = Character->GetActorLocation();\r\n\t\tFRotator CharacterRotation = Character->GetActorRotation();\r\n\t\t\t\r\n\t\tFVector ForwardVector = CharacterRotation.Vector();  \r\n\t\tFVector TeleportLocation = CharacterLocation + (ForwardVector * 500.0f); \r\n\t\t\r\n\t\t\r\n\t\tif (UCharacterMovementComponent* MovementComp = Character->GetCharacterMovement())\r\n\t\t{\r\n\t\t\tif (bIsUpsideDown)\r\n\t\t\t{\r\n\t\t\t\tTeleportLocation.Z -= TeleportDown;  \r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tTeleportLocation.Z += TeleportDistance;\r\n\t\t\t\tbIsRotated = !bIsRotated;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(TeleportSound)\r\n\t\t{\r\n\t\t\tUGameplayStatics::PlaySoundAtLocation(this, TeleportSound, GetActorLocation());\r\n\t\t}\r\n\t\t\t\r\n\t\tCharacter->SetActorLocation(TeleportLocation);\r\n\t\t\r\n\t}\r\n}\r\n\r\nvoid ARotateDoor::SetTeleportTarget(const FVector& NewTargetLocation)\r\n{\r\n\tTeleportTargetLocation = NewTargetLocation;\r\n}\r\n\r\nvoid ARotateDoor::SetDoorColor(const FLinearColor& NewColor)\r\n{\r\n\tif(!DoorMesh) return;\r\n\r\n\tint32 MaterialIndex = 1;\r\n\t\r\n\t// 创建动态材质实例\r\n\tUMaterialInstanceDynamic* DynamicMaterial = DoorMesh->CreateAndSetMaterialInstanceDynamic(MaterialIndex);\r\n\tif(DynamicMaterial)\r\n\t{\r\n\t\tDynamicMaterial->SetVectorParameterValue(TEXT(\"BaseColorFactor\"), NewColor);\r\n\t\tif(PaintSound)\r\n\t\t{\r\n\t\t\tUGameplayStatics::PlaySoundAtLocation(this, PaintSound, GetActorLocation());\r\n\t\t}\r\n\t}\r\n\t\r\n\tif (LinkedHidePass)\r\n\t{\r\n\t\tLinkedHidePass->CheckAndReveal(NewColor);\r\n\t}\r\n}\r\n\r\nvoid ARotateDoor::SetLinkedHidePass(class AHidePass* NewHidePass)\r\n{\r\n\tLinkedHidePass = NewHidePass;\r\n\r\n\tif(LinkedHidePass)\r\n\t{\r\n\t\tLinkedHidePass->SetRequiredColor(RequiredPaintColor);\r\n\t}\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Source/declassify_door/Private/Actor/RotateDoor.cpp b/Source/declassify_door/Private/Actor/RotateDoor.cpp
--- a/Source/declassify_door/Private/Actor/RotateDoor.cpp	(revision e7ff85ca446efe4cb52d3a21a1d22a5359844e57)
+++ b/Source/declassify_door/Private/Actor/RotateDoor.cpp	(date 1765449069513)
@@ -50,7 +50,7 @@
 	FVector DoorDown = -DoorUp;
 	
 	FVector CurrentLocation = DoorMesh->GetRelativeLocation();
-	CurrentLocation += DoorDown * 340.0f; 
+	CurrentLocation += DoorDown * 260.0f; 
 	
 	DoorMesh->SetRelativeLocation(CurrentLocation);
 	
