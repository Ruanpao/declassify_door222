Index: Source/declassify_door/Public/Actor/FinalDoor.h
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Fill out your copyright notice in the Description page of Project Settings.\r\n\r\n#pragma once\r\n\r\n#include \"CoreMinimal.h\"\r\n#include \"GameFramework/Actor.h\"\r\n#include \"Interface/InteractInterface.h\" // 添加接口头文件\r\n#include \"FinalDoor.generated.h\"\r\n\r\nUCLASS()\r\nclass DECLASSIFY_DOOR_API AFinalDoor : public AActor, public IInteractInterface\r\n{\r\n\tGENERATED_BODY()\r\n    \r\npublic: \r\n\tAFinalDoor();\r\n\r\nprotected:\r\n\tvirtual void BeginPlay() override;\r\n\r\npublic: \r\n\tvirtual void Tick(float DeltaTime) override;\r\n\r\n\tUFUNCTION()\r\n\tvoid AddKey();\r\n    \r\n\t// 实现交互接口\r\n\tUFUNCTION(BlueprintCallable, Category = \"Interaction\")\r\n\tvirtual void OnInteract_Implementation(AActor* Interactor) override;\r\n\r\n    \r\nprivate:\r\n\tUFUNCTION()\r\n\tvoid ReturnToMainMenu();\r\n    \r\n\tUPROPERTY(EditAnywhere, Category = \"FinalDoor\")\r\n\tclass UStaticMeshComponent* DoorMesh;\r\n\r\n\tint32 CurrentNumberOfKeys = 0;\r\n\r\n\tUPROPERTY(EditAnywhere, Category = \"FinalDoor\")\r\n\tclass USoundBase* DoorCreateSound;\r\n    \r\n\tUPROPERTY(EditAnywhere, Category = \"FinalDoor\")\r\n\tclass USoundBase* InteractSound; // 交互音效\r\n};
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Source/declassify_door/Public/Actor/FinalDoor.h b/Source/declassify_door/Public/Actor/FinalDoor.h
--- a/Source/declassify_door/Public/Actor/FinalDoor.h	(revision f28ad82ec7d8308129538096713bf44ef8406221)
+++ b/Source/declassify_door/Public/Actor/FinalDoor.h	(date 1765535024801)
@@ -28,7 +28,9 @@
 	UFUNCTION(BlueprintCallable, Category = "Interaction")
 	virtual void OnInteract_Implementation(AActor* Interactor) override;
 
-    
+	UFUNCTION(BlueprintCallable,Category="FinalDoor")
+	void StartCameraTransition(APawn* TargetPawn);
+	
 private:
 	UFUNCTION()
 	void ReturnToMainMenu();
@@ -36,6 +38,9 @@
 	UPROPERTY(EditAnywhere, Category = "FinalDoor")
 	class UStaticMeshComponent* DoorMesh;
 
+	UPROPERTY(VisibleAnywhere,Category="Pass")
+	class UCameraComponent* PassCamera;
+
 	int32 CurrentNumberOfKeys = 0;
 
 	UPROPERTY(EditAnywhere, Category = "FinalDoor")
@@ -43,4 +48,18 @@
     
 	UPROPERTY(EditAnywhere, Category = "FinalDoor")
 	class USoundBase* InteractSound; // 交互音效
+
+	UPROPERTY(EditAnywhere,BlueprintReadWrite,Category="FinalDoor",meta=(AllowPrivateAccess="true"))
+	float ColorTolerance = 0.1f;
+
+	UPROPERTY(EditAnywhere,Category = "FinalDoor",meta = (AllowPrivateAccess = "true"))
+	float CameraTransitionTime = 2.0f;
+
+	UPROPERTY(EditAnywhere, Category = "FinalDoor", meta = (AllowPrivateAccess = "true"))
+	float CameraHoldTime = 3.0f;
+	
+	APawn* OriginalPawn = nullptr;
+	FTimerHandle CameraTimerHandle;
+
+	void ReturnToPlayerCamera();
 };
\ No newline at end of file
Index: Source/declassify_door/Private/Actor/FinalDoor.cpp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Fill out your copyright notice in the Description page of Project Settings.\r\n\r\n#include \"Actor/FinalDoor.h\"\r\n#include \"Actor/DoorPiece.h\"\r\n#include \"Kismet/GameplayStatics.h\"\r\n#include \"MainMenu/MainMenuPlayerController.h\"\r\n\r\nAFinalDoor::AFinalDoor()\r\n{\r\n    PrimaryActorTick.bCanEverTick = true;\r\n\r\n    RootComponent = CreateDefaultSubobject<USceneComponent>(TEXT(\"Root\"));\r\n    DoorMesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT(\"DoorMesh\"));\r\n    DoorMesh->SetupAttachment(RootComponent);\r\n\r\n    DoorMesh->SetVisibility(false);\r\n    \r\n}\r\n\r\nvoid AFinalDoor::BeginPlay()\r\n{\r\n    Super::BeginPlay();\r\n\r\n    TArray<AActor*> FoundPieces;\r\n    UGameplayStatics::GetAllActorsOfClass(GetWorld(), ADoorPiece::StaticClass(), FoundPieces);\r\n\r\n    for(AActor* Piece : FoundPieces)\r\n    {\r\n        ADoorPiece* PieceActor = Cast<ADoorPiece>(Piece);\r\n        if(PieceActor)\r\n        {\r\n            PieceActor->OnDoorOpened.AddDynamic(this, &AFinalDoor::AddKey);\r\n        }\r\n    }\r\n}\r\n\r\nvoid AFinalDoor::Tick(float DeltaTime)\r\n{\r\n    Super::Tick(DeltaTime);\r\n}\r\n\r\nvoid AFinalDoor::AddKey()\r\n{\r\n    CurrentNumberOfKeys++;\r\n    \r\n    if(CurrentNumberOfKeys == 3)\r\n    {\r\n        DoorMesh->SetVisibility(true);\r\n        // 启用碰撞，允许交互\r\n        //DoorMesh->SetCollisionEnabled(ECollisionEnabled::QueryAndPhysics);\r\n        \r\n        if(DoorCreateSound)\r\n        {\r\n            UGameplayStatics::PlaySoundAtLocation(this, DoorCreateSound, GetActorLocation());\r\n        }\r\n    }\r\n}\r\n\r\nvoid AFinalDoor::OnInteract_Implementation(AActor* Interactor)\r\n{\r\n    // 只有在门可见时才允许交互\r\n    if (DoorMesh->IsVisible())\r\n    {\r\n        UE_LOG(LogTemp, Warning, TEXT(\"FinalDoor interacted - Returning to main menu\"));\r\n\r\n        if(InteractSound)\r\n        {\r\n            UGameplayStatics::PlaySoundAtLocation(this, InteractSound, GetActorLocation());\r\n        }\r\n        \r\n        // 回到主菜单\r\n        ReturnToMainMenu();\r\n    }\r\n    else\r\n    {\r\n        UE_LOG(LogTemp, Warning, TEXT(\"FinalDoor is not visible - Interaction ignored\"));\r\n    }\r\n}\r\n\r\nvoid AFinalDoor::ReturnToMainMenu()\r\n{\r\n        // 备用方案：直接加载主菜单地图\r\n    UGameplayStatics::OpenLevel(GetWorld(), \"MenuMap\");\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Source/declassify_door/Private/Actor/FinalDoor.cpp b/Source/declassify_door/Private/Actor/FinalDoor.cpp
--- a/Source/declassify_door/Private/Actor/FinalDoor.cpp	(revision f28ad82ec7d8308129538096713bf44ef8406221)
+++ b/Source/declassify_door/Private/Actor/FinalDoor.cpp	(date 1765536198788)
@@ -2,6 +2,7 @@
 
 #include "Actor/FinalDoor.h"
 #include "Actor/DoorPiece.h"
+#include "Camera/CameraComponent.h"
 #include "Kismet/GameplayStatics.h"
 #include "MainMenu/MainMenuPlayerController.h"
 
@@ -14,7 +15,9 @@
     DoorMesh->SetupAttachment(RootComponent);
 
     DoorMesh->SetVisibility(false);
-    
+
+    PassCamera = CreateDefaultSubobject<UCameraComponent>(TEXT("PassCamera"));
+    PassCamera->SetupAttachment(RootComponent);
 }
 
 void AFinalDoor::BeginPlay()
@@ -53,6 +56,13 @@
         {
             UGameplayStatics::PlaySoundAtLocation(this, DoorCreateSound, GetActorLocation());
         }
+
+        APawn* PlayerPawn = UGameplayStatics::GetPlayerPawn(this, 0);
+        if (PlayerPawn)
+        {
+            StartCameraTransition(PlayerPawn);
+        }
+        
     }
 }
 
@@ -77,9 +87,46 @@
     }
 }
 
+void AFinalDoor::StartCameraTransition(APawn* TargetPawn)
+{
+    if(!TargetPawn || !TargetPawn->GetController())
+    {
+        return;
+    }
+
+    OriginalPawn = TargetPawn;
+    APlayerController* PC = Cast<APlayerController>(TargetPawn->GetController());
+    if(!PC)
+    {
+        return;
+    }
+
+    // 直接从玩家摄像机切换摄像机
+    PC->SetViewTargetWithBlend(this, CameraTransitionTime, VTBlend_Cubic, 1.0f, false);
+    
+    OriginalPawn->SetActorLocation(FVector(0, 0, 600));
+    
+    
+    GetWorld()->GetTimerManager().SetTimer(CameraTimerHandle, this, &AFinalDoor::ReturnToPlayerCamera, CameraHoldTime + CameraTransitionTime, false);
+
+}
+
 void AFinalDoor::ReturnToMainMenu()
 {
         // 备用方案：直接加载主菜单地图
     UGameplayStatics::OpenLevel(GetWorld(), "MenuMap");
 }
 
+void AFinalDoor::ReturnToPlayerCamera()
+{
+    if(OriginalPawn && OriginalPawn->GetController())
+    {
+        APlayerController* PC = Cast<APlayerController>(OriginalPawn->GetController());
+        if(PC)
+        {
+            PC->SetViewTargetWithBlend(OriginalPawn, CameraTransitionTime, VTBlend_Cubic, 1.0f, false);
+        }
+    }
+    OriginalPawn = nullptr;
+}
+
Index: Source/declassify_door/Public/Actor/HidePass.h
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Fill out your copyright notice in the Description page of Project Settings.\r\n\r\n#pragma once\r\n\r\n#include \"CoreMinimal.h\"\r\n#include \"GameFramework/Actor.h\"\r\n#include \"Components/TextRenderComponent.h\"\r\n#include \"HidePass.generated.h\"\r\n\r\nUCLASS()\r\nclass DECLASSIFY_DOOR_API AHidePass : public AActor\r\n{\r\n\tGENERATED_BODY()\r\n\t\r\npublic:\t\r\n\tAHidePass();\r\n\r\nprotected:\r\n\tvirtual void BeginPlay() override;\r\n\r\npublic:\t\r\n\tvirtual void Tick(float DeltaTime) override;\r\n\r\n\tUFUNCTION(BlueprintCallable,Category=\"Pass\")\r\n\tvoid SetRequiredColor(const FLinearColor& Color);\r\n\r\n\tUFUNCTION(BlueprintCallable,Category=\"Pass\")\r\n\tvoid CheckAndReveal(const FLinearColor& DoorColor);\r\n\r\n\tUFUNCTION(BlueprintCallable,Category=\"Pass\")\r\n\tvoid SetWallVisible(bool bVisible);\r\n\r\n\tUFUNCTION(BlueprintCallable,Category=\"Pass\")\r\n\tbool IsRevealed() const{return bIsRevealed;}\r\n\r\n\tUFUNCTION(BlueprintCallable,Category=\"Pass\")\r\n\tUTextRenderComponent* GetTextRenderComponent() const{return TextRenderer;}\r\n\r\nprivate:\r\n\tUPROPERTY(VisibleAnywhere,Category=\"Pass\")\r\n\tclass UStaticMeshComponent* WallMesh;\r\n\r\n\tUPROPERTY(VisibleAnywhere,Category=\"Pass\")\r\n\tclass UTextRenderComponent* TextRenderer;\r\n\r\n\tUPROPERTY(EditAnywhere,BlueprintReadWrite,Category=\"Pass\",meta=(AllowPrivateAccess=\"true\"))\r\n\tFLinearColor RequiredColor = FLinearColor::Red;\r\n\r\n\tUPROPERTY(VisibleAnywhere,BlueprintReadOnly,Category=\"Pass\",meta=(AllowPrivateAccess=\"true\"))\r\n\tbool bIsRevealed = false;\r\n\r\n\tUPROPERTY(EditAnywhere,BlueprintReadWrite,Category=\"Pass\",meta=(AllowPrivateAccess=\"true\"))\r\n\tfloat ColorTolerance = 0.1f;\r\n};\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Source/declassify_door/Public/Actor/HidePass.h b/Source/declassify_door/Public/Actor/HidePass.h
--- a/Source/declassify_door/Public/Actor/HidePass.h	(revision f28ad82ec7d8308129538096713bf44ef8406221)
+++ b/Source/declassify_door/Public/Actor/HidePass.h	(date 1765536256101)
@@ -36,6 +36,9 @@
 	UFUNCTION(BlueprintCallable,Category="Pass")
 	UTextRenderComponent* GetTextRenderComponent() const{return TextRenderer;}
 
+	UFUNCTION(BlueprintCallable,Category="Pass")
+	void StartCameraTransition(APawn* TargetPawn);
+	
 private:
 	UPROPERTY(VisibleAnywhere,Category="Pass")
 	class UStaticMeshComponent* WallMesh;
@@ -43,6 +46,12 @@
 	UPROPERTY(VisibleAnywhere,Category="Pass")
 	class UTextRenderComponent* TextRenderer;
 
+	UPROPERTY(VisibleAnywhere,Category="Pass")
+	class UCameraComponent* PassCamera;
+
+	UPROPERTY(EditAnywhere,Category = "Pass")
+	class USoundBase * SucceedSound;
+
 	UPROPERTY(EditAnywhere,BlueprintReadWrite,Category="Pass",meta=(AllowPrivateAccess="true"))
 	FLinearColor RequiredColor = FLinearColor::Red;
 
@@ -51,4 +60,16 @@
 
 	UPROPERTY(EditAnywhere,BlueprintReadWrite,Category="Pass",meta=(AllowPrivateAccess="true"))
 	float ColorTolerance = 0.1f;
+
+	UPROPERTY(EditAnywhere,Category = "Pass",meta = (AllowPrivateAccess = "true"))
+	float CameraTransitionTime = 2.0f;
+
+	UPROPERTY(EditAnywhere, Category = "Pass", meta = (AllowPrivateAccess = "true"))
+	float CameraHoldTime = 2.0f;
+	
+
+	FTimerHandle CameraTimerHandle;
+	APawn* OriginalPawn = nullptr;
+	
+	void ReturnToPlayerCamera();
 };
Index: Source/declassify_door/Private/Actor/HidePass.cpp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Fill out your copyright notice in the Description page of Project Settings.\r\n\r\n\r\n#include \"Actor/HidePass.h\"\r\n#include \"Components/StaticMeshComponent.h\"\r\n#include \"Components/TextRenderComponent.h\"\r\n#include \"Engine/Engine.h\"\r\n\r\nAHidePass::AHidePass()\r\n{\r\n\tPrimaryActorTick.bCanEverTick = true;\r\n\r\n\t// 创建根组件\r\n\tUSceneComponent* Root = CreateDefaultSubobject<USceneComponent>(TEXT(\"Root\"));\r\n\tRootComponent = Root;\r\n\r\n\t// 创建墙体网格\r\n\tWallMesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT(\"WallMesh\"));\r\n\tWallMesh->SetupAttachment(RootComponent);\r\n\r\n\tTextRenderer = CreateDefaultSubobject<UTextRenderComponent>(TEXT(\"TextRenderer\"));\r\n\tTextRenderer->SetupAttachment(WallMesh);\r\n\tTextRenderer->SetRelativeLocation(FVector(0,0,180.0f));\r\n\tTextRenderer->SetRelativeRotation(FRotator(0, 180.0f, 0)); \r\n\tTextRenderer->SetHorizontalAlignment(EHTA_Center);\r\n\tTextRenderer->SetVerticalAlignment(EVRTA_TextCenter);\r\n\tTextRenderer->SetTextRenderColor(FColor::White);\r\n\tTextRenderer->SetWorldSize(50.0f);\r\n}\r\n\r\n\r\nvoid AHidePass::BeginPlay()\r\n{\r\n\tSuper::BeginPlay();\r\n\r\n\tSetWallVisible(false);\r\n}\r\n\r\n\r\nvoid AHidePass::Tick(float DeltaTime)\r\n{\r\n\tSuper::Tick(DeltaTime);\r\n\r\n}\r\n\r\nvoid AHidePass::SetRequiredColor(const FLinearColor& Color)\r\n{\r\n\tRequiredColor = Color;\r\n}\r\n\r\nvoid AHidePass::CheckAndReveal(const FLinearColor& DoorColor)\r\n{\r\n\tif(bIsRevealed)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tbool bColorMatches = \r\n\t\tFMath::Abs(DoorColor.R - RequiredColor.R) < ColorTolerance &&\r\n\t\tFMath::Abs(DoorColor.G - RequiredColor.G) < ColorTolerance &&\r\n\t\tFMath::Abs(DoorColor.B - RequiredColor.B) < ColorTolerance;\r\n\t\r\n\tif(bColorMatches)\r\n\t{\r\n\t\tSetWallVisible(true);\r\n\t\tbIsRevealed = true;\r\n\r\n\t\tUE_LOG(LogTemp, Log, TEXT(\"密码墙显示,门颜色匹配\"));\r\n\r\n\t\t\r\n\t}\r\n}\r\n\r\nvoid AHidePass::SetWallVisible(bool bVisible)\r\n{\r\n\tWallMesh->SetVisibility(bVisible);\r\n\tWallMesh->SetCollisionEnabled(bVisible ? ECollisionEnabled::QueryAndPhysics : ECollisionEnabled::NoCollision);\r\n\r\n\tTextRenderer->SetVisibility(bVisible);\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Source/declassify_door/Private/Actor/HidePass.cpp b/Source/declassify_door/Private/Actor/HidePass.cpp
--- a/Source/declassify_door/Private/Actor/HidePass.cpp	(revision f28ad82ec7d8308129538096713bf44ef8406221)
+++ b/Source/declassify_door/Private/Actor/HidePass.cpp	(date 1765534549286)
@@ -2,9 +2,14 @@
 
 
 #include "Actor/HidePass.h"
+
+#include "Camera/CameraComponent.h"
 #include "Components/StaticMeshComponent.h"
 #include "Components/TextRenderComponent.h"
 #include "Engine/Engine.h"
+#include "Kismet/GameplayStatics.h"
+#include "GameFramework/PlayerController.h"
+#include "Camera/PlayerCameraManager.h"
 
 AHidePass::AHidePass()
 {
@@ -26,6 +31,12 @@
 	TextRenderer->SetVerticalAlignment(EVRTA_TextCenter);
 	TextRenderer->SetTextRenderColor(FColor::White);
 	TextRenderer->SetWorldSize(50.0f);
+
+	PassCamera = CreateDefaultSubobject<UCameraComponent>(TEXT("PassCamera"));
+	PassCamera->SetupAttachment(RootComponent);
+	PassCamera->SetRelativeLocation(FVector(100.0f, 0, 250.0f));  // 在文字前方100，上方250
+	PassCamera->SetRelativeRotation(FRotator(-20.0f, 180.0f, 0)); // 稍微向下看，朝向文字
+	PassCamera->FieldOfView = 60.0f;
 }
 
 
@@ -67,7 +78,16 @@
 
 		UE_LOG(LogTemp, Log, TEXT("密码墙显示,门颜色匹配"));
 
+		if(SucceedSound)
+		{
+			UGameplayStatics::PlaySoundAtLocation(this, SucceedSound, GetActorLocation());
+		}
 		
+		APawn* PlayerPawn = UGameplayStatics::GetPlayerPawn(this, 0);
+		if (PlayerPawn)
+		{
+			StartCameraTransition(PlayerPawn);
+		}
 	}
 }
 
@@ -79,3 +99,40 @@
 	TextRenderer->SetVisibility(bVisible);
 }
 
+
+void AHidePass::StartCameraTransition(APawn* TargetPawn)
+{
+	if(!TargetPawn || !TargetPawn->GetController())
+	{
+		return;
+	}
+
+	OriginalPawn = TargetPawn;
+	APlayerController* PC = Cast<APlayerController>(TargetPawn->GetController());
+	if(!PC)
+	{
+		return;
+	}
+
+	// 直接从玩家摄像机切换到HidePass的摄像机
+	PC->SetViewTargetWithBlend(this, CameraTransitionTime, VTBlend_Cubic, 1.0f, false);
+	
+	GetWorld()->GetTimerManager().SetTimer(CameraTimerHandle, this, &AHidePass::ReturnToPlayerCamera, CameraHoldTime + CameraTransitionTime, false);
+}
+
+
+
+void AHidePass::ReturnToPlayerCamera()
+{
+	if(OriginalPawn && OriginalPawn->GetController())
+	{
+		APlayerController* PC = Cast<APlayerController>(OriginalPawn->GetController());
+		if(PC)
+		{
+			PC->SetViewTargetWithBlend(OriginalPawn, CameraTransitionTime, VTBlend_Cubic, 1.0f, false);
+		}
+	}
+	OriginalPawn = nullptr;
+}
+
+
